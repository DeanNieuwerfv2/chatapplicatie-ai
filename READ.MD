# Chatapplicatie â€“ AI met Amazon Bedrock & React

Dit project is een complete chatapplicatie met:

- **Frontend**: React + Vite + Tailwind (single-page chat UI)
- **Backend**: FastAPI (Python) met Amazon Bedrock (Claude 3 Haiku)
- **Opslag**: Amazon S3 (chatconversaties per bericht gelogd)
- **Hosting**:
  - Backend: AWS App Runner (Docker container uit ECR)
  - Frontend: S3 static website (optioneel achter CloudFront)

> Doel van de repo: laten zien hoe je van scratch een moderne AI-chatapp bouwt en deployt op AWS.

---

## ğŸ— Architectuur

```text
[Browser] 
   â”‚
   â”‚  HTTPS (fetch /chat)
   â–¼
[Frontend: React/Vite/Tailwind]  (S3 website / CloudFront)
   â”‚
   â”‚  HTTPS (REST JSON)
   â–¼
[Backend: FastAPI @ App Runner]  (Docker)
   â”‚
   â”œâ”€â–º [Amazon Bedrock â€“ Claude 3 Haiku]
   â”‚
   â””â”€â–º [Amazon S3 â€“ conversatielogs]
ğŸ“ Projectstructuur
text
Code kopiÃ«ren
.
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ main.py              # FastAPI app (Bedrock + S3 logging)
â”‚   â”œâ”€â”€ Dockerfile           # Container voor App Runner / ECR
â”‚   â”œâ”€â”€ pyproject.toml       # Python project config (uv)
â”‚   â”œâ”€â”€ uv.lock              # Dependency lockfile
â”‚   â””â”€â”€ .env.example         # Voorbeeld van environment-variabelen
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/App.jsx          # Chat UI
â”‚   â”œâ”€â”€ src/index.css        # Tailwind + custom styles
â”‚   â”œâ”€â”€ vite.config.js       # Vite config
â”‚   â””â”€â”€ package.json         # Frontend dependencies/scripts
â”‚
â””â”€â”€ README.md                # Dit bestand
âœ… Vereisten
Lokaal ontwikkelen
Node.js 18+

npm of pnpm

Python 3.11+ (in dit project 3.12)

uv als Python package manager (https://docs.astral.sh/uv/)

Docker Desktop (voor lokaal testen van de container)

AWS CLI geconfigureerd (aws configure)

Voor productie / AWS
AWS-account (met toegang tot:

Amazon Bedrock (Claude 3 Haiku model geactiveerd)

Amazon S3

Amazon ECR

AWS App Runner

IAM permissies om:

Images naar ECR te pushen

App Runner services aan te maken

Bedrock modellen aan te roepen

S3 buckets te lezen/schrijven

ğŸ” Environment variables
Backend (backend/.env)
Maak backend/.env aan (voor lokaal) gebaseerd op:

env
Code kopiÃ«ren
AWS_REGION=eu-west-1
BEDROCK_MODEL_ID=anthropic.claude-3-haiku-20240307-v1:0
CHAT_LOG_BUCKET=je-s3-bucket-voor-conversaties
Voor App Runner zet je deze als Environment variables in de service-config.

Let op: Geen .env bestanden committen â€“ gebruik .env.example in de repo als referentie.

â–¶ï¸ Backend lokaal draaien (zonder Docker)
bash
Code kopiÃ«ren
cd backend
uv sync                     # dependencies installeren
uv run uvicorn main:app --reload --port 8000
De API is dan beschikbaar op:

Health check: http://localhost:8000/health

OpenAPI docs: http://localhost:8000/docs

Belangrijkste endpoint
POST /chat

Request:

json
Code kopiÃ«ren
{
  "message": "Hallo!",
  "conversation_id": "optioneel-uuid"
}
Response:

json
Code kopiÃ«ren
{
  "reply": "Antwoord van de AI...",
  "conversation_id": "per-conversatie-uuid"
}
Bij elke call worden:

het user-bericht (role=user)

het AI-antwoord (role=assistant)

eventuele fouten (role=system)

opgeslagen als losse JSON-bestanden in S3:

text
Code kopiÃ«ren
s3://<CHAT_LOG_BUCKET>/conversations/<conversation_id>/<timestamp>-<role>.json
ğŸ¨ Frontend lokaal draaien
bash
Code kopiÃ«ren
cd frontend
npm install
npm run dev
De app is bereikbaar op:

http://localhost:5173

De frontend stuurt fetch requests naar de backend:

js
Code kopiÃ«ren
const res = await fetch("http://localhost:8000/chat", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    message: userMessage.content,
    conversation_id: conversationId,
  }),
});
In productie moet de URL worden aangepast naar de App Runner URL (zie onder).

ğŸ³ Backend container builden en lokaal testen
In de map backend/ staat een Dockerfile die de FastAPI-app containeriseert.

Image builden
bash
Code kopiÃ«ren
cd backend
docker build -t chat-backend .
Container runnen
bash
Code kopiÃ«ren
docker run -p 8000:8000 chat-backend
De API is dan (opnieuw) bereikbaar op http://localhost:8000 en de frontend kan daartegen praten.

â˜ï¸ Deploy naar AWS
1. Image naar ECR pushen
Maak een ECR repository, bijv. chat-backend

Login bij ECR:

bash
Code kopiÃ«ren
aws ecr get-login-password --region eu-west-1 \
  | docker login --username AWS --password-stdin <ACCOUNT-ID>.dkr.ecr.eu-west-1.amazonaws.com
Tag & push:

bash
Code kopiÃ«ren
docker tag chat-backend:latest <ACCOUNT-ID>.dkr.ecr.eu-west-1.amazonaws.com/chat-backend:latest
docker push <ACCOUNT-ID>.dkr.ecr.eu-west-1.amazonaws.com/chat-backend:latest
2. App Runner service
In AWS Console â†’ App Runner â†’ Create service

Source: Container registry â†’ Amazon ECR

Kies de chat-backend:latest image

Port: 8000

Environment vars:

text
Code kopiÃ«ren
AWS_REGION=eu-west-1
BEDROCK_MODEL_ID=anthropic.claude-3-haiku-20240307-v1:0
CHAT_LOG_BUCKET=je-s3-bucket-voor-conversaties
IAM roles:

ECR access role (kan door App Runner automatisch worden aangemaakt)

Instance role met o.a.:

Bedrock toegang (bijv. AmazonBedrockFullAccess of beperkt beleid)

S3 toegang tot het log-bucket

CloudWatch Logs toegang

Na creation krijg je een URL zoals:

text
Code kopiÃ«ren
https://<random>.eu-west-1.awsapprunner.com
De health check (/health) moet daar {"status":"ok"} geven.

ğŸŒ Frontend deployen naar S3
Build:

bash
Code kopiÃ«ren
cd frontend
npm run build
Maak een S3 bucket, bijv. chatapplicatie-frontend

Zet static website hosting aan, met index.html als indexdocument

Upload de inhoud van dist/:

index.html

map assets/

Maak de objects public (via bucket policy, bijv.):

json
Code kopiÃ«ren
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "PublicReadForStaticWebsite",
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::chatapplicatie-frontend/*"
    }
  ]
}
Pas in src/App.jsx de fetch-URL aan naar je App Runner endpoint:

js
Code kopiÃ«ren
const res = await fetch("https://<your-app-runner-url>/chat", { ... })
Rebuild & opnieuw uploaden.

Optioneel: zet CloudFront vÃ³Ã³r de S3 website voor HTTPS en betere performance.

